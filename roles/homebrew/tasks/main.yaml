- name: set facts homebrew role
  set_fact:
    homebrew_path: "/home/linuxbrew/.linuxbrew/Homebrew/bin"

- name: install homebrew
  shell:
    cmd: |
      /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    creates: "{{ homebrew_path }}/brew"

- name: add homebrew to path
  ansible.builtin.blockinfile:
    path: "~/.bashrc"
    marker: "# {mark} ANSIBLE MANAGED BLOCK: homebrew"
    block: |
      PATH="$PATH:{{ homebrew_path }}"

- name: template update homebrew script
  become: true
  template:
    src: homebrew-upgrade.j2.sh
    dest: "{{update_packages_script.dir}}/homebrew-upgrade"
    mode: "u=rwx,go=rx"
