- hosts: all
  vars:
    update_packages_script:
      dir: /usr/local/bin/update-script.d

  pre_tasks:
    - name: Get user
      tags: always
      ansible.builtin.shell: whoami
      changed_when: false
      register: user_command
    - tags: always
      set_fact:
        user: "{{ user_command.stdout.strip() }}"
    - set_fact:
        default_shell: /bin/bash
    - set_fact:
        default_shell: /bin/zsh
      when: enable_zsh | default(false)
    - ansible.builtin.import_tasks: tasks/basicsetup.yml
      when: enable_basicsetup | default(false)
      tags: basicsetup
    - ansible.builtin.import_tasks: tasks/ubuntu_desktop.yml
      when: enable_ubuntu_desktop | default(false)
      tags: ubuntu_desktop
    - name: Gather the package facts
      tags: always
      ansible.builtin.package_facts:
    - name: Add ansible ppa
      when: enable_ansible_ppa | default(false)
      tags: ansible-ppa
      become: true
      command:
        cmd: |
          sudo add-apt-repository -y ppa:ansible/ansible
        creates: "{{ ansible.apt_list_file }}"

  roles:
    - role: zsh
      tags: zsh
      when: enable_zsh | default(false)
    - role: update_packages_script
      tags: update_packages_script
    - role: homebrew
      tags: homebrew
      when: enable_homebrew | default(false)
    - role: ansible-role-customize-gnome
      tags: customize_gnome
      when: enable_customize_gnome | default(false)
      vars:
        gnome_extensions:
          - url: https://extensions.gnome.org/extension-data/sound-output-device-chooserkgshank.net.v43.shell-extension.zip
            id: 906
          - url: https://extensions.gnome.org/extension-data/wsmatrixmartin.zurowietz.de.v23.shell-extension.zip
            id: 1485
        customize_gnome__skip_restart_gnome_shell: customize_gnome__skip_restart_gnome_shell | default(false)
    - role: gnome
      tags: gnome
    - role: bash
      tags: bash
      when: enable_bash | default(false)
    - role: kubectl
      tags: kubectl
      when: enable_kubectl | default(false)
    - role: tmux
      tags: tmux
      when: enable_tmux | default(false)

    - role: git-tools
      tags: git
      when: enable_git_tools | default(false)
      vars:
        git_aliases: true
        git_rerere: true
        git_editor_nano: true
        git_user_name: "{{git.config.user_name | mandatory}}"
        git_user_email: "{{git.config.user_email | mandatory}}"

    - role: docker
      tags: docker
      when: docker.enable | default(false)

    - role: php_development
      tags: php_development

    - role: okular
      tags: okular
      when: enable_okular | default(false)

    - role: ansible-role-visual-studio-code
      tags: visual-studio-code
      when: enable_visula_studio_code | default(false)

    - role: basic_utils
      tags: basic_utils

    - role: windows
      when: windows.enable | default(false)

    - role: azure_cli
      tags: azure_cli

    - role: motd
      tags: motd

    - role: displaylink_driver
      tags: displaylink_driver

    - role: vagrant
      tags: vagrant

    - role: zed
      tags: zed

    - role: fzf
      tags: fzf

    - role: yazi
      tags: yazi

  post_tasks:
    - include_tasks: tasks/ubuntu_cleanup.yml
      when: enable_ubuntu_cleanup | default(false)
